<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="assets/img/favicon.ico" sizes="any">
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="assets/img/apple-touch-icon.png">
  <meta property="og:image" content="https://earthbackproject.org/assets/img/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Join Earthback ‚Äî Find your people. Build something that lasts.</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ‚îÄ‚îÄ BRAND TOKENS ‚îÄ‚îÄ */
    :root {
      --ink:        #1a2218;
      --ink-soft:   #2d3d28;
      --text:       #3b4a3a;
      --text-muted: #6b7a63;
      --paper:      #f2efe6;
      --paper-warm: #ece7da;
      --card:       #faf8f3;
      --white:      #fffefb;
      --green:      #1F3A2E;
      --green2:     #2d5a27;
      --sage:       #5a7d52;
      --moss:       #7a9e6c;
      --pale-green: #e4eddf;
      --clay:       #C2A56C;
      --clay2:      #b8784a;
      --sand:       #d4c09a;
      --sand-light: #e8dcc0;
      --border:     #d0c4a8;
      --border-lt:  #e0d8c4;
      --shadow:     rgba(30,55,40,0.08);
      --shadow-d:   rgba(30,55,40,0.16);
      --font-serif: 'Cormorant Garamond', Georgia, serif;
      --font-sans:  'Inter', system-ui, sans-serif;
      --radius:     14px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { font-family: var(--font-sans); background: var(--paper); color: var(--text); min-height: 100vh; }

    /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
    .screen { display: none; min-height: 100vh; flex-direction: column; }
    .screen.active { display: flex; }

    /* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
    .topbar {
      position: sticky; top: 0; z-index: 50;
      background: linear-gradient(135deg, var(--green), #2d5a27);
      padding: 14px 32px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 12px var(--shadow-d);
    }
    .topbar-brand { display: flex; align-items: center; gap: 10px; color: var(--white); text-decoration: none; }
    .topbar-brand-mark { font-size: 1.2rem; }
    .topbar-brand-name { font-family: var(--font-serif); font-size: 1.3rem; font-weight: 500; letter-spacing: 0.02em; }
    .topbar-brand-name .brand-sub { opacity: 0.55; font-weight: 300; font-size: 0.85rem; margin-left: 4px; }
    .topbar-link { color: rgba(255,255,255,0.7); font-size: 0.85rem; text-decoration: none; font-weight: 500; }
    .topbar-link:hover { color: white; }
/* Brand treatment for topbar */
.topbar-the {
    opacity: 0.45;
    font-size: 0.7em;
    font-weight: 300;
    margin-right: 3px;
    vertical-align: 0.08em;
}

    /* ‚îÄ‚îÄ STEP INDICATOR ‚îÄ‚îÄ */
    .step-bar {
      background: rgba(255,255,255,0.08);
      padding: 10px 32px;
      display: flex; align-items: center; gap: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.07);
    }
    .step-item {
      display: flex; align-items: center; gap: 6px;
      font-size: 0.75rem; font-weight: 600; color: rgba(255,255,255,0.45);
      text-transform: uppercase; letter-spacing: 0.06em;
    }
    .step-item.active { color: rgba(255,255,255,0.85); }
    .step-item.done { color: var(--moss); }
    .step-num {
      width: 20px; height: 20px; border-radius: 50%;
      background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center;
      font-size: 0.65rem; font-weight: 700; flex-shrink: 0;
    }
    .step-item.active .step-num { background: var(--clay); color: var(--ink); }
    .step-item.done .step-num { background: var(--moss); color: white; }
    .step-sep { color: rgba(255,255,255,0.2); font-size: 0.7rem; }

    /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
    .content { flex: 1; display: flex; align-items: flex-start; justify-content: center; padding: 48px 24px 60px; }
    .content-inner { width: 100%; max-width: 560px; }

    /* ‚îÄ‚îÄ FORM STYLES ‚îÄ‚îÄ */
    .form-title { font-family: var(--font-serif); font-size: clamp(1.8rem, 4vw, 2.6rem); font-weight: 400; color: var(--ink); line-height: 1.15; margin-bottom: 10px; }
    .form-title em { font-style: italic; color: var(--clay); }
    .form-sub { font-size: 0.98rem; color: var(--text-muted); line-height: 1.6; margin-bottom: 32px; max-width: 44ch; }

    .field { margin-bottom: 20px; }
    .field label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--text); text-transform: uppercase; letter-spacing: 0.07em; margin-bottom: 7px; }
    .field label span { font-weight: 400; color: var(--text-muted); text-transform: none; letter-spacing: 0; margin-left: 4px; font-size: 0.78rem; }
    .field input, .field select, .field textarea {
      width: 100%; padding: 13px 16px;
      border: 1px solid var(--border); border-radius: 10px;
      background: var(--white); color: var(--ink); font-size: 0.96rem;
      font-family: var(--font-sans); outline: none; transition: border 0.15s;
    }
    .field input:focus, .field select:focus, .field textarea:focus { border-color: var(--green2); box-shadow: 0 0 0 3px rgba(45,90,39,0.08); }
    .field textarea { resize: vertical; min-height: 80px; line-height: 1.55; }
    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

    .btn-primary {
      width: 100%; padding: 15px 24px;
      background: linear-gradient(135deg, var(--green), var(--green2));
      border: none; border-radius: 11px; color: var(--white);
      font-size: 1rem; font-weight: 600; font-family: var(--font-sans);
      cursor: pointer; letter-spacing: 0.01em;
      box-shadow: 0 4px 16px rgba(31,58,46,0.3);
      transition: all 0.2s;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 22px rgba(31,58,46,0.38); }
    .btn-secondary {
      background: transparent; border: 1px solid var(--border);
      border-radius: 10px; padding: 11px 20px;
      font-size: 0.9rem; font-weight: 500; color: var(--text-muted);
      cursor: pointer; font-family: var(--font-sans); transition: all 0.15s;
    }
    .btn-secondary:hover { border-color: var(--text-muted); color: var(--text); }

    .divider-label {
      display: flex; align-items: center; gap: 12px; margin: 24px 0;
      font-size: 0.78rem; color: var(--text-muted); font-weight: 500;
    }
    .divider-label::before, .divider-label::after { content: ""; flex: 1; height: 1px; background: var(--border-lt); }

    .card { background: var(--card); border-radius: var(--radius); padding: 28px; border: 1px solid var(--border-lt); box-shadow: 0 1px 8px var(--shadow); }

    .btn-google {
      width: 100%; padding: 13px 24px;
      background: var(--white); border: 1px solid var(--border);
      border-radius: 11px; font-size: 0.95rem; font-weight: 500;
      font-family: var(--font-sans); color: var(--ink);
      cursor: pointer; display: flex; align-items: center;
      justify-content: center; gap: 10px; transition: all 0.15s;
    }
    .btn-google:hover { border-color: var(--text-muted); box-shadow: 0 2px 8px var(--shadow); }
    .btn-google svg { flex-shrink: 0; }

    /* ‚îÄ‚îÄ SCREEN 1: SIGN UP ‚îÄ‚îÄ */
    #screen-signup .trust-row {
      display: flex; gap: 20px; margin-top: 28px; padding-top: 24px;
      border-top: 1px solid var(--border-lt);
    }
    .trust-item { display: flex; align-items: flex-start; gap: 9px; font-size: 0.82rem; color: var(--text-muted); line-height: 1.5; }
    .trust-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }

    /* ‚îÄ‚îÄ SCREEN 2: AI PROFILER ‚îÄ‚îÄ */
    #screen-profiler .url-area {
      background: var(--pale-green); border-radius: 12px;
      padding: 22px; border: 1px solid rgba(90,125,82,0.18); margin-bottom: 20px;
    }
    #screen-profiler .url-hint {
      font-size: 0.8rem; color: var(--text-muted); margin-top: 8px; line-height: 1.5;
    }
    #screen-profiler .url-hint a { color: var(--green2); text-decoration: none; }

    /* Scanning animation */
    .scan-overlay {
      display: none; padding: 32px; text-align: center;
    }
    .scan-overlay.visible { display: block; }
    .scan-spinner {
      width: 56px; height: 56px; margin: 0 auto 20px;
      border-radius: 50%;
      border: 3px solid var(--pale-green);
      border-top-color: var(--green2);
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .scan-stage { font-size: 1.05rem; font-weight: 600; color: var(--ink); margin-bottom: 6px; }
    .scan-substage { font-size: 0.85rem; color: var(--text-muted); }
    .scan-stages-list {
      display: flex; flex-direction: column; gap: 6px; margin-top: 24px;
      text-align: left;
    }
    .scan-step {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 14px; border-radius: 8px;
      font-size: 0.83rem; color: var(--text-muted);
      transition: all 0.3s;
    }
    .scan-step.done { background: var(--pale-green); color: var(--green2); font-weight: 500; }
    .scan-step.active { background: rgba(45,90,39,0.06); color: var(--ink); font-weight: 600; }
    .scan-step-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--border); flex-shrink: 0;
    }
    .scan-step.done .scan-step-dot { background: var(--moss); }
    .scan-step.active .scan-step-dot { background: var(--green2); animation: pulse 1.2s infinite; }
    @keyframes pulse { 0%,100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.4); opacity: 0.6; } }

    /* Profile preview */
    .preview-section { display: none; }
    .preview-section.visible { display: block; }
    .preview-header {
      display: flex; align-items: center; gap: 14px;
      background: linear-gradient(135deg, rgba(31,58,46,0.06), rgba(90,125,82,0.08));
      border-radius: 12px; padding: 18px; border: 1px solid rgba(31,58,46,0.1); margin-bottom: 20px;
    }
    .preview-avatar {
      width: 56px; height: 56px; border-radius: 50%;
      background: linear-gradient(135deg, var(--green), var(--sage));
      display: flex; align-items: center; justify-content: center;
      color: white; font-weight: 700; font-size: 1.2rem;
      flex-shrink: 0;
    }
    .preview-name { font-family: var(--font-serif); font-size: 1.3rem; color: var(--ink); margin-bottom: 2px; }
    .preview-tagline { font-size: 0.84rem; color: var(--text-muted); font-style: italic; }

    .preview-skills { display: flex; flex-wrap: wrap; gap: 7px; }
    .skill-pill {
      padding: 5px 12px; border-radius: 7px; font-size: 0.8rem; font-weight: 500;
    }
    .skill-lead { background: rgba(31,58,46,0.1); color: var(--green); border: 1px solid rgba(31,58,46,0.2); }
    .skill-exp { background: rgba(90,125,82,0.1); color: var(--sage); border: 1px solid rgba(90,125,82,0.2); }
    .skill-learn { background: rgba(194,165,108,0.12); color: var(--clay2); border: 1px solid rgba(194,165,108,0.25); }

    .confidence-badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 4px 10px; border-radius: 20px; font-size: 0.74rem; font-weight: 600;
      background: rgba(90,125,82,0.12); color: var(--sage);
      border: 1px solid rgba(90,125,82,0.2); margin-bottom: 16px;
    }

    @media (max-width: 768px) {
      .field-row { grid-template-columns: 1fr; }
    }
  </style>
  <!-- Supabase JS (UMD ‚Äî no bundler needed) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>

<!-- Netlify Forms: hidden form Netlify detects at deploy time -->
<form name="earthback-signup" netlify netlify-honeypot="bot-field" hidden>
  <input name="bot-field" type="hidden">
  <input name="first-name" type="text">
  <input name="last-name" type="text">
  <input name="email" type="email">
  <input name="location" type="text">
  <input name="member-type" type="text">
  <input name="what-bring" type="text">
  <input name="what-seek" type="text">
</form>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 1: SIGN UP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-signup" class="screen active">
  <nav class="topbar">
    <a href="index.html" class="topbar-brand">
      <span class="topbar-brand-mark">üåø</span>
      <span class="topbar-brand-name"><span class="topbar-the">the</span> Earthback <span class="brand-sub">Project</span></span>
    </a>
    <a href="index.html" class="topbar-link">‚Üê Back to site</a>
  </nav>
  <div style="background: linear-gradient(135deg, var(--green), #2d5a27); padding: 6px 32px; display:flex; gap:20px; align-items:center;">
    <div class="step-item active"><div class="step-num">1</div> Create account</div>
    <div class="step-sep">‚Ä∫</div>
    <div class="step-item" id="step2-label"><div class="step-num">2</div> Build your profile</div>
    <div class="step-sep">‚Ä∫</div>
    <div class="step-item" id="step3-label"><div class="step-num">3</div> See the community</div>
  </div>
  <div class="content">
    <div class="content-inner">
      <div class="fade-up">
        <h1 class="form-title">Find your people.<br><em>Build something that lasts.</em></h1>
        <p class="form-sub">Join the coordination layer for regenerative builders ‚Äî hempcrete walls, off-grid systems, community housing, food forests, and more.</p>
      </div>
      <div class="card fade-up-2">
        <button class="btn-google" onclick="signUpWithGoogle()">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59a14.5 14.5 0 0 1 0-9.18l-7.98-6.19a24.0 24.0 0 0 0 0 21.56l7.98-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Sign up with Google
        </button>

        <div class="divider-label">or sign up with email</div>

        <div class="field-row">
          <div class="field">
            <label>First name</label>
            <input type="text" id="first-name" placeholder="Maya" autocomplete="given-name" />
          </div>
          <div class="field">
            <label>Last name <span>(or nickname)</span></label>
            <input type="text" id="last-name" placeholder="Redhawk" autocomplete="family-name" />
          </div>
        </div>
        <div class="field">
          <label>Email address</label>
          <input type="email" id="email" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div class="field">
          <label>Location <span>(city, region, or general area)</span></label>
          <input type="text" id="location" placeholder="Taos, New Mexico" autocomplete="off" />
        </div>
        <div class="field">
          <label>What do you bring? <span>(tell us in your own words)</span></label>
          <textarea id="what-bring" placeholder="Skills, resources, knowledge, land, time ‚Äî whatever feels right. This is just for you and us. No one sees it until you choose to share." rows="3"></textarea>
        </div>
        <div class="field">
          <label>What are you looking for?</label>
          <textarea id="what-seek" placeholder="People, skills, tools, advice, collaborators, a community ‚Äî say as much or as little as you want." rows="2"></textarea>
        </div>
        <div class="field">
          <label>You're joining as</label>
          <select id="partner-type">
            <option value="individual">Individual builder / grower / maker</option>
            <option value="org">Organization or nonprofit</option>
            <option value="community">Community or cooperative</option>
            <option value="tribal">Tribal nation or indigenous community</option>
          </select>
        </div>
        <button class="btn-primary" id="get-started-btn" onclick="goToProfiler()">Get Started ‚Üí</button>

        <!-- Magic link sent notice (appears after form submit) -->
        <div id="magic-link-notice" style="display:none; margin-top:14px; padding:12px 16px; background:rgba(90,125,82,0.08); border:1px solid rgba(90,125,82,0.18); border-radius:10px; font-size:0.82rem; color:var(--text-muted); line-height:1.55; display:none; align-items:center; gap:8px;">
          <span style="font-size:1rem; flex-shrink:0;">‚úâÔ∏è</span>
          <span>We sent a sign-in link to <strong id="magic-link-email" style="color:var(--ink);"></strong>. Click it anytime to unlock your account and sign in again.</span>
        </div>

        <div class="trust-row">
          <div class="trust-item"><span class="trust-icon">üîí</span><div>Your identity is never shown publicly without your consent. You choose how you're known.</div></div>
          <div class="trust-item"><span class="trust-icon">üåø</span><div>No ads, no algorithms, no selling your data. Ever. <a href="privacy.html" style="color:var(--moss);text-decoration:underline;">Privacy policy</a>.</div></div>
          <div class="trust-item"><span class="trust-icon">üìú</span><div>Your data belongs to you. <a href="terms.html" style="color:var(--moss);text-decoration:underline;">Terms of service</a>.</div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 2: AI PROFILER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screen-profiler" class="screen">
  <nav class="topbar">
    <a href="index.html" class="topbar-brand">
      <span class="topbar-brand-mark">üåø</span>
      <span class="topbar-brand-name"><span class="topbar-the">the</span> Earthback <span class="brand-sub">Project</span></span>
    </a>
  </nav>
  <div style="background: linear-gradient(135deg, var(--green), #2d5a27); padding: 6px 32px; display:flex; gap:20px; align-items:center;">
    <div class="step-item done"><div class="step-num">‚úì</div> Account created</div>
    <div class="step-sep">‚Ä∫</div>
    <div class="step-item active"><div class="step-num">2</div> Build your profile</div>
    <div class="step-sep">‚Ä∫</div>
    <div class="step-item" id="step3-label2"><div class="step-num">3</div> See the community</div>
  </div>
  <div class="content">
    <div class="content-inner">
      <!-- URL input section -->
      <div id="url-section">
        <div class="fade-up">
          <h1 class="form-title">Let us build your<br><em>profile for you.</em></h1>
          <p class="form-sub">Paste a URL ‚Äî your LinkedIn, website, org page, or anything with your work on it ‚Äî and we'll read it and fill in your profile automatically. You review and edit everything before it's saved.</p>
        </div>
        <div class="card fade-up-2">
          <div class="url-area">
            <div class="field" style="margin-bottom:10px;">
              <label>Your LinkedIn, website, or any public page</label>
              <input type="url" id="profile-url" placeholder="https://linkedin.com/in/yourname  or  https://yourorg.org" />
            </div>
            <div class="url-hint">Works with: LinkedIn ¬∑ Personal website ¬∑ Organization page ¬∑ Facebook ¬∑ Instagram bio ¬∑ Any public page with your work on it</div>
          </div>

          <button class="btn-primary" onclick="startScan()" id="scan-btn">Build My Profile ‚Üí</button>

          <div class="divider-label">or</div>

          <button class="btn-secondary" style="width:100%;" onclick="showManualPreview()">Skip ‚Äî I'll fill it in myself</button>
        </div>
      </div>

      <!-- Scanning animation -->
      <div class="scan-overlay" id="scan-overlay">
        <div class="card" style="text-align:left;">
          <div style="text-align:center; margin-bottom:24px;">
            <div class="scan-spinner"></div>
            <div class="scan-stage" id="scan-stage-text">Searching the web‚Ä¶</div>
            <div class="scan-substage" id="scan-sub-text">Finding your public pages</div>
          </div>
          <div class="scan-stages-list" id="scan-stages-list">
            <div class="scan-step" id="scan-s1" data-active="false"><div class="scan-step-dot"></div>Searching for public pages</div>
            <div class="scan-step" id="scan-s2" data-active="false"><div class="scan-step-dot"></div>Reading your work and background</div>
            <div class="scan-step" id="scan-s3" data-active="false"><div class="scan-step-dot"></div>Extracting skills and projects</div>
            <div class="scan-step" id="scan-s4" data-active="false"><div class="scan-step-dot"></div>Building your Earthback profile</div>
            <div class="scan-step" id="scan-s5" data-active="false"><div class="scan-step-dot"></div>Review ready</div>
          </div>
        </div>
      </div>

      <!-- Profile preview -->
      <div class="preview-section" id="preview-section">
        <div class="fade-up">
          <h1 class="form-title">Here's what<br><em>we found.</em></h1>
          <p class="form-sub">Review and edit anything. This is your profile ‚Äî we're just offering a starting point.</p>
        </div>
        <div class="card fade-up-2">
          <div class="confidence-badge">üåø Profile confidence: <strong>High</strong> ‚Äî sourced from 3 pages</div>

          <div class="preview-header">
            <div class="preview-avatar" id="preview-avatar">NM</div>
            <div>
              <div class="preview-name" id="preview-name">Nicco MacIntyre</div>
              <div class="preview-tagline" id="preview-tagline">Building the infrastructure for community-led regeneration</div>
            </div>
          </div>

          <div class="field">
            <label>Display name <span>(what the community sees)</span></label>
            <input type="text" id="edit-name" value="" />
          </div>
          <div class="field">
            <label>Tagline</label>
            <input type="text" id="edit-tagline" value="" />
          </div>
          <div class="field">
            <label>Bio</label>
            <textarea id="edit-bio" rows="3"></textarea>
          </div>
          <div class="field">
            <label>Location</label>
            <input type="text" id="edit-location" value="" />
          </div>

          <div class="field">
            <label>Skills we found <span>(tap to remove any that don't fit)</span></label>
            <div class="preview-skills" id="preview-skills-list">
              <span class="skill-pill skill-lead" onclick="toggleSkill(this)">Hempcrete Construction</span>
              <span class="skill-pill skill-lead" onclick="toggleSkill(this)">3D Printing (Construction)</span>
              <span class="skill-pill skill-exp" onclick="toggleSkill(this)">Community Organizing</span>
              <span class="skill-pill skill-exp" onclick="toggleSkill(this)">Sustainable Building Design</span>
              <span class="skill-pill skill-exp" onclick="toggleSkill(this)">Project Coordination</span>
              <span class="skill-pill skill-learn" onclick="toggleSkill(this)">Hemp Processing</span>
              <span class="skill-pill skill-learn" onclick="toggleSkill(this)">Solar Integration</span>
            </div>
          </div>

          <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn-primary" style="flex:1;" onclick="goToDashboard()">Drop My Pin on the Map ‚Üí</button>
            <button class="btn-secondary" onclick="document.getElementById('url-section').style.display='block'; document.getElementById('preview-section').classList.remove('visible');">Edit</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard moved to feed.html ‚Äî /community now serves feed.html -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     JAVASCRIPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ SUPABASE CLIENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SUPABASE_URL = 'https://yptktmzagctusbeqdaty.supabase.co';
const SUPABASE_KEY = 'sb_publishable_zp8dWs1CaN-A5oeR94qRdw_n7jNDhmC';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ‚îÄ‚îÄ USER STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let user = {
  firstName: "", lastName: "", email: "", location: "",
  displayName: "", tagline: "", bio: "", skills: [],
};

// ‚îÄ‚îÄ GOOGLE OAUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function signUpWithGoogle() {
  const { error } = await sb.auth.signInWithOAuth({
    provider: 'google',
    options: {
      redirectTo: 'https://earthbackproject.org/auth-callback.html',
    },
  });
  if (error) {
    alert('Google sign-up failed ‚Äî please try again or use email instead.');
  }
}

// ‚îÄ‚îÄ SCREEN TRANSITIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
}

// ‚îÄ‚îÄ INLINE FIELD ERROR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fieldError(id, msg) {
  const el = document.getElementById(id);
  el.style.borderColor = 'var(--clay2)';
  el.style.boxShadow = '0 0 0 3px rgba(184,120,74,0.15)';
  let err = el.parentElement.querySelector('.field-err');
  if (!err) {
    err = document.createElement('div');
    err.className = 'field-err';
    err.style.cssText = 'font-size:0.75rem;color:var(--clay2);margin-top:4px;';
    el.parentElement.appendChild(err);
  }
  err.textContent = msg;
  el.addEventListener('input', () => {
    el.style.borderColor = '';
    el.style.boxShadow = '';
    if (err) err.remove();
  }, { once: true });
}

// ‚îÄ‚îÄ NETLIFY FORM SUBMISSION (background) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function submitSignup(data) {
  const body = new URLSearchParams({
    'form-name': 'earthback-signup',
    'bot-field': '',
    ...data
  }).toString();
  try {
    await fetch('/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body
    });
  } catch (e) {
    // Silent fail ‚Äî never block the UX
  }
}

// ‚îÄ‚îÄ SCREEN 1 ‚Üí 2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function goToProfiler() {
  const fn = document.getElementById('first-name').value.trim();
  const ln = document.getElementById('last-name').value.trim();
  const em = document.getElementById('email').value.trim();
  const lo = document.getElementById('location').value.trim();
  const wb = document.getElementById('what-bring').value.trim();
  const ws = document.getElementById('what-seek').value.trim();
  const mt = document.getElementById('partner-type').value;
  const btn = document.getElementById('get-started-btn');

  let valid = true;
  if (!fn) { fieldError('first-name', 'First name is required'); valid = false; }
  if (!em || !em.includes('@')) { fieldError('email', 'A valid email is required'); valid = false; }
  if (!valid) return;

  btn.textContent = 'Getting things ready‚Ä¶';
  btn.disabled = true;

  // 1. Save to Netlify Forms (background, non-blocking)
  submitSignup({
    'first-name': fn, 'last-name': ln, 'email': em,
    'location': lo, 'what-bring': wb, 'what-seek': ws, 'member-type': mt
  });

  // 2. Save profile data to localStorage so auth-callback.html can persist it
  localStorage.setItem('earthback_pending_profile', JSON.stringify({
    firstName: fn, lastName: ln, email: em, location: lo,
    displayName: (fn + ' ' + ln).trim(),
    memberType: mt, whatBring: wb, whatSeek: ws,
  }));

  // 3. Send magic link via Supabase (non-blocking ‚Äî user continues to demo)
  sb.auth.signInWithOtp({
    email: em,
    options: { emailRedirectTo: 'https://earthbackproject.org/auth-callback.html' },
  }).then(({ error }) => {
    if (!error) {
      // Show the "link sent" notice
      const notice = document.getElementById('magic-link-notice');
      document.getElementById('magic-link-email').textContent = em;
      notice.style.display = 'flex';
    }
  });

  // 4. Populate in-memory user object and proceed to demo flow
  user.firstName = fn;
  user.lastName = ln;
  user.email = em;
  user.location = lo || 'Location not set';
  user.displayName = (fn + ' ' + ln).trim();

  setTimeout(() => {
    btn.textContent = 'Get Started ‚Üí';
    btn.disabled = false;
    showScreen('screen-profiler');
  }, 600);
}

// ‚îÄ‚îÄ SCAN SIMULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startScan() {
  const url = document.getElementById('profile-url').value.trim();
  if (!url) {
    showManualPreview();
    return;
  }

  document.getElementById('url-section').style.display = 'none';
  document.getElementById('scan-overlay').classList.add('visible');

  const stages = [
    { id: 'scan-s1', main: 'Searching the web‚Ä¶', sub: 'Finding your public pages' },
    { id: 'scan-s2', main: 'Reading your work‚Ä¶', sub: 'Extracting background and projects' },
    { id: 'scan-s3', main: 'Identifying skills‚Ä¶', sub: 'Mapping to Earthback taxonomy' },
    { id: 'scan-s4', main: 'Building your profile‚Ä¶', sub: 'Structuring your contributions' },
    { id: 'scan-s5', main: 'Ready for review', sub: 'Your profile is ready to review' },
  ];

  let step = 0;
  function runStep() {
    if (step > 0) {
      document.getElementById(stages[step - 1].id).classList.remove('active');
      document.getElementById(stages[step - 1].id).classList.add('done');
    }
    if (step < stages.length) {
      document.getElementById(stages[step].id).classList.add('active');
      document.getElementById('scan-stage-text').textContent = stages[step].main;
      document.getElementById('scan-sub-text').textContent = stages[step].sub;
      step++;
      setTimeout(runStep, step < 5 ? 900 : 600);
    } else {
      setTimeout(showProfilePreview, 400);
    }
  }
  runStep();
}

function showProfilePreview() {
  document.getElementById('scan-overlay').classList.remove('visible');
  populatePreview();
  document.getElementById('preview-section').classList.add('visible');
  window.scrollTo(0, 0);
}

function showManualPreview() {
  document.getElementById('url-section').style.display = 'none';
  populatePreview();
  document.getElementById('preview-section').classList.add('visible');
}

function populatePreview() {
  const initials = user.displayName.split(' ').map(n => n[0]).join('').toUpperCase() || 'ME';
  document.getElementById('preview-avatar').textContent = initials;
  document.getElementById('preview-name').textContent = user.displayName || 'Your Name';
  document.getElementById('edit-name').value = user.displayName || '';
  document.getElementById('edit-tagline').value = 'Building regenerative communities from the ground up';
  document.getElementById('edit-bio').value = user.location
    ? `Based in ${user.location}. Passionate about sustainable building, community coordination, and the work of making regenerative living more accessible.`
    : 'Passionate about sustainable building, community coordination, and the work of making regenerative living more accessible.';
  document.getElementById('edit-location').value = user.location || '';
}

function toggleSkill(el) {
  el.style.opacity = el.style.opacity === '0.35' ? '1' : '0.35';
  el.style.textDecoration = el.style.textDecoration === 'line-through' ? 'none' : 'line-through';
}

// ‚îÄ‚îÄ SCREEN 2 ‚Üí COMMUNITY (redirect to feed.html) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function goToDashboard(profileOverride) {
  if (profileOverride) {
    user.displayName = profileOverride.displayName || user.displayName;
    user.tagline     = profileOverride.tagline     || 'Building something better';
    user.bio         = profileOverride.bio         || '';
    user.location    = profileOverride.location    || user.location;
    user.email       = profileOverride.email       || user.email;
  } else {
    user.displayName = document.getElementById('edit-name').value || user.displayName;
    user.tagline = document.getElementById('edit-tagline').value;
    user.bio = document.getElementById('edit-bio').value;
    user.location = document.getElementById('edit-location').value || user.location;
  }
  // Save to sessionStorage so feed.html can use it without a DB round-trip
  sessionStorage.setItem('earthback_fresh_profile', JSON.stringify(user));
  window.location.href = '/community';
}

// ‚îÄ‚îÄ SIGN OUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function handleSignOut() {
  await sb.auth.signOut();
  window.location.href = 'index.html';
}

// ‚îÄ‚îÄ AUTH INIT (runs on page load) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function initAuth() {
  const params = new URLSearchParams(window.location.search);

  // Returning from magic link? Go straight to feed.
  if (params.get('signed-in') === '1') {
    window.location.href = '/community';
    return;
  }

  // Already signed in? Go to feed.
  const { data: { session } } = await sb.auth.getSession();
  if (session) {
    window.location.href = '/community';
    return;
  }

  // Not signed in ‚Äî show the signup form (default state, nothing to do)
}

// Run on load
window.addEventListener('DOMContentLoaded', initAuth);
</script>
</body>
</html>
